{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { createStackNavigator } from \"@react-navigation/stack\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { setAuth, selectAuth } from \"../../contexts/slices/authSlice\";\nimport { getCurrentTimeStamp } from \"../../utils/date\";\nimport { expireTime } from \"../../configs/token\";\nimport { getTimeFromToken } from \"../../utils/token\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Login = React.lazy(function () {\n  return import(\"../Login\");\n});\nvar Menu = React.lazy(function () {\n  return import(\"../Menu\");\n});\n\nvar Main = function Main() {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      views = _useState2[0],\n      setViews = _useState2[1];\n\n  var Stack = createStackNavigator();\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(selectAuth),\n      authResult = _useSelector.authResult;\n\n  for (var _iterator = _createForOfIteratorHelperLoose(authResult == null ? void 0 : (_authResult$data = authResult.data) == null ? void 0 : _authResult$data.permission), _step; !(_step = _iterator()).done;) {\n    var _authResult$data;\n\n    var iterator = _step.value;\n    var view = [];\n    view[iterator.MenuId] = React.lazy(function () {\n      return import(\"../CheckStock\");\n    });\n    setViews([].concat(_toConsumableArray(views), view));\n  }\n\n  var validateToken = function _callee() {\n    var auth, accessTime, currentTime;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.t0 = JSON;\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"auth\"));\n\n          case 4:\n            _context.t1 = _context.sent;\n\n            if (_context.t1) {\n              _context.next = 7;\n              break;\n            }\n\n            _context.t1 = \"{}\";\n\n          case 7:\n            _context.t2 = _context.t1;\n            auth = _context.t0.parse.call(_context.t0, _context.t2);\n\n            if (auth.status) {\n              accessTime = getTimeFromToken(auth.data.token);\n              currentTime = getCurrentTimeStamp();\n\n              if (currentTime - accessTime > expireTime) {\n                Alert.alert(\"Alert\", \"Your token is expired, please login again\", [{\n                  text: \"OK\",\n                  onPress: function onPress() {\n                    dispatch(setAuth({}));\n                  }\n                }]);\n              }\n\n              dispatch(setAuth(auth));\n            } else {\n              dispatch(setAuth({}));\n            }\n\n            _context.next = 15;\n            break;\n\n          case 12:\n            _context.prev = 12;\n            _context.t3 = _context[\"catch\"](0);\n            console.log(_context.t3);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 12]], Promise);\n  };\n\n  useEffect(function () {\n    validateToken();\n  }, []);\n  return _jsx(_Fragment, {\n    children: _jsx(Stack.Navigator, {\n      children: authResult != null && authResult.status ? _jsxs(_Fragment, {\n        children: [_jsx(Stack.Screen, {\n          name: \"Menu\",\n          component: Menu\n        }), views.map(function (item, index) {\n          return _jsx(Stack.Screen, {\n            name: item.MenuId,\n            component: views[item.MenuId]\n          });\n        })]\n      }) : _jsx(Stack.Screen, {\n        name: \"Login\",\n        component: Login\n      })\n    })\n  });\n};\n\nexport default Main;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","createStackNavigator","AsyncStorage","setAuth","selectAuth","getCurrentTimeStamp","expireTime","getTimeFromToken","Login","lazy","Menu","Main","views","setViews","Stack","dispatch","authResult","data","permission","iterator","view","MenuId","validateToken","JSON","getItem","auth","parse","status","accessTime","token","currentTime","Alert","alert","text","onPress","console","log","map","item","index"],"sources":["D:/Dev/pk-mobile/src/views/Main/Main.tsx"],"sourcesContent":["import React, { ReactNode, useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Alert } from \"react-native\";\nimport { createStackNavigator } from \"@react-navigation/stack\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nimport { setAuth, selectAuth } from \"../../contexts/slices/authSlice\";\n\nimport { getCurrentTimeStamp } from \"../../utils/date\";\nimport { expireTime } from \"../../configs/token\";\nimport { getTimeFromToken } from \"../../utils/token\";\nimport { ReactInstance } from \"react\";\nimport { convertAbsoluteToRem } from \"native-base/lib/typescript/theme/tools\";\n\nconst Login = React.lazy(() => import(\"../Login\"));\nconst Menu = React.lazy(() => import(\"../Menu\"));\n\nconst Main: React.FC = () => {\n\n  const [views, setViews] = useState<ReactNode[]>([]);\n\n  const Stack: any = createStackNavigator();\n  const dispatch = useDispatch();\n  const { authResult } = useSelector(selectAuth);\n\n  for (const iterator of authResult?.data?.permission) {\n\n    let view: ReactNode[] = [];\n\n\n\n    view[iterator.MenuId] = React.lazy(() => import(`../CheckStock`));\n   \n\n    setViews([...views, ...view]);\n  }\n\n  const validateToken = async () => {\n    try {\n      //? get token, status from AsyncStorage\n      const auth: any = JSON.parse(\n        (await AsyncStorage.getItem(\"auth\")) || \"{}\"\n      );\n\n      if (auth.status) {\n        const accessTime = getTimeFromToken(auth.data.token);\n        const currentTime = getCurrentTimeStamp();\n\n        //? if token is expired\n        if (currentTime - accessTime > expireTime) {\n          Alert.alert(\"Alert\", \"Your token is expired, please login again\", [\n            {\n              text: \"OK\",\n              onPress: () => {\n                dispatch(setAuth({}));\n              },\n            },\n          ]);\n        }\n\n        //? if token is valid\n        dispatch(setAuth(auth));\n      } else {\n        dispatch(setAuth({}));\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  useEffect(() => {\n    validateToken();\n  }, []);\n\n  return (\n    <>\n      <Stack.Navigator>\n        {authResult?.status ? (\n          <>\n            <Stack.Screen name=\"Menu\" component={Menu} />\n            {views.map((item: any, index: number) => {\n              return (\n                <Stack.Screen\n                  name={item.MenuId}\n                  component={views[item.MenuId as any]}\n                />\n              );\n            })}\n          </>\n        ) : (\n          <Stack.Screen name=\"Login\" component={Login} />\n        )}\n      </Stack.Navigator>\n    </>\n  );\n};\n\nexport default Main;\n"],"mappings":";;;;;;;;;;AAAA,OAAOA,KAAP,IAA2BC,SAA3B,EAAsCC,QAAtC,QAAsD,OAAtD;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;;AAEA,SAASC,oBAAT,QAAqC,yBAArC;AACA,OAAOC,YAAP,MAAyB,2CAAzB;AAEA,SAASC,OAAT,EAAkBC,UAAlB;AAEA,SAASC,mBAAT;AACA,SAASC,UAAT;AACA,SAASC,gBAAT;;;;AAIA,IAAMC,KAAK,GAAGZ,KAAK,CAACa,IAAN,CAAW;EAAA,OAAM,kBAAN;AAAA,CAAX,CAAd;AACA,IAAMC,IAAI,GAAGd,KAAK,CAACa,IAAN,CAAW;EAAA,OAAM,iBAAN;AAAA,CAAX,CAAb;;AAEA,IAAME,IAAc,GAAG,SAAjBA,IAAiB,GAAM;EAE3B,gBAA0Bb,QAAQ,CAAc,EAAd,CAAlC;EAAA;EAAA,IAAOc,KAAP;EAAA,IAAcC,QAAd;;EAEA,IAAMC,KAAU,GAAGb,oBAAoB,EAAvC;EACA,IAAMc,QAAQ,GAAGhB,WAAW,EAA5B;;EACA,mBAAuBC,WAAW,CAACI,UAAD,CAAlC;EAAA,IAAQY,UAAR,gBAAQA,UAAR;;EAEA,qDAAuBA,UAAvB,wCAAuBA,UAAU,CAAEC,IAAnC,qBAAuB,iBAAkBC,UAAzC,wCAAqD;IAAA;;IAAA,IAA1CC,QAA0C;IAEnD,IAAIC,IAAiB,GAAG,EAAxB;IAIAA,IAAI,CAACD,QAAQ,CAACE,MAAV,CAAJ,GAAwBzB,KAAK,CAACa,IAAN,CAAW;MAAA,OAAM,uBAAN;IAAA,CAAX,CAAxB;IAGAI,QAAQ,8BAAKD,KAAL,GAAeQ,IAAf,EAAR;EACD;;EAED,IAAME,aAAa,GAAG;IAAA;IAAA;MAAA;QAAA;UAAA;YAAA;YAAA,cAGAC,IAHA;YAAA;YAAA,iCAITrB,YAAY,CAACsB,OAAb,CAAqB,MAArB,CAJS;;UAAA;YAAA;;YAAA;cAAA;cAAA;YAAA;;YAAA,cAIwB,IAJxB;;UAAA;YAAA;YAGZC,IAHY,eAGKC,KAHL;;YAOlB,IAAID,IAAI,CAACE,MAAT,EAAiB;cACTC,UADS,GACIrB,gBAAgB,CAACkB,IAAI,CAACR,IAAL,CAAUY,KAAX,CADpB;cAETC,WAFS,GAEKzB,mBAAmB,EAFxB;;cAKf,IAAIyB,WAAW,GAAGF,UAAd,GAA2BtB,UAA/B,EAA2C;gBACzCyB,KAAK,CAACC,KAAN,CAAY,OAAZ,EAAqB,2CAArB,EAAkE,CAChE;kBACEC,IAAI,EAAE,IADR;kBAEEC,OAAO,EAAE,mBAAM;oBACbnB,QAAQ,CAACZ,OAAO,CAAC,EAAD,CAAR,CAAR;kBACD;gBAJH,CADgE,CAAlE;cAQD;;cAGDY,QAAQ,CAACZ,OAAO,CAACsB,IAAD,CAAR,CAAR;YACD,CAlBD,MAkBO;cACLV,QAAQ,CAACZ,OAAO,CAAC,EAAD,CAAR,CAAR;YACD;;YA3BiB;YAAA;;UAAA;YAAA;YAAA;YA6BlBgC,OAAO,CAACC,GAAR;;UA7BkB;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAtB;;EAiCAvC,SAAS,CAAC,YAAM;IACdyB,aAAa;EACd,CAFQ,EAEN,EAFM,CAAT;EAIA,OACE;IAAA,UACE,KAAC,KAAD,CAAO,SAAP;MAAA,UACGN,UAAU,QAAV,IAAAA,UAAU,CAAEW,MAAZ,GACC;QAAA,WACE,KAAC,KAAD,CAAO,MAAP;UAAc,IAAI,EAAC,MAAnB;UAA0B,SAAS,EAAEjB;QAArC,EADF,EAEGE,KAAK,CAACyB,GAAN,CAAU,UAACC,IAAD,EAAYC,KAAZ,EAA8B;UACvC,OACE,KAAC,KAAD,CAAO,MAAP;YACE,IAAI,EAAED,IAAI,CAACjB,MADb;YAEE,SAAS,EAAET,KAAK,CAAC0B,IAAI,CAACjB,MAAN;UAFlB,EADF;QAMD,CAPA,CAFH;MAAA,EADD,GAaC,KAAC,KAAD,CAAO,MAAP;QAAc,IAAI,EAAC,OAAnB;QAA2B,SAAS,EAAEb;MAAtC;IAdJ;EADF,EADF;AAqBD,CA9ED;;AAgFA,eAAeG,IAAf"},"metadata":{},"sourceType":"module"}